<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…’ç«¥å¥åº·èˆ‡é£²é£Ÿè©•ä¼°å·¥å…·</title>
    <!-- å¼•å…¥ Tailwind CSS ä»¥é€²è¡Œå¿«é€Ÿã€ç¾è§€çš„æ’ç‰ˆ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* éš±è—æ²è»¸ä½†ä¿ç•™æ»¾å‹•åŠŸèƒ½ (é‡å°éƒ¨åˆ†ç¾åŒ–éœ€æ±‚) */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        /* è‡ªå®šç¾©ä¸€äº›éæ¸¡å‹•ç•«è®“æ“ä½œæ›´æ»‘é † */
        .transition-all { transition-property: all; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 300ms; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen flex flex-col items-center py-10 px-4 font-sans space-y-8">

    <!-- å›åˆ°å¤§å»³æŒ‰éˆ• -->
    <a href="https://lukehsiao-yc.github.io/for_healthy_children/" 
       style="position: fixed; 
              top: 20px; 
              left: 20px; 
              background-color: #f43f5e; 
              color: white; 
              padding: 10px 16px; 
              border-radius: 50px; 
              text-decoration: none; 
              font-weight: bold; 
              box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
              z-index: 9999; 
              display: flex; 
              align-items: center; 
              font-family: 'Noto Sans TC', sans-serif;
              transition: transform 0.2s;"
       onmouseover="this.style.transform='scale(1.05)'"
       onmouseout="this.style.transform='scale(1)'">
       <span style="margin-right: 6px; font-size: 18px;">ğŸ </span> å›åˆ°å¤§å»³
    </a>

    <!-- ========================================== -->
    <!-- å¡ç‰‡ 1ï¼šå°ç£å…’ç«¥æ¯æ—¥é£²é£Ÿå»ºè­°é‡æŸ¥è©¢ -->
    <!-- ========================================== -->
    <div class="bg-white rounded-2xl shadow-xl w-full max-w-lg overflow-hidden border border-slate-100">
        
        <!-- é ‚éƒ¨æ¨™é¡Œå€å¡Š -->
        <div class="bg-blue-600 p-6 text-white text-center">
            <h1 class="text-2xl font-bold mb-2">ğŸ å°ç£å…’ç«¥æ¯æ—¥é£²é£Ÿå»ºè­°é‡æŸ¥è©¢</h1>
            <p class="text-blue-100 text-sm mb-1">å‘Šåˆ¥é›²æœµäºº å…’ç«¥æ¸›é‡ä¸€èµ·ä¾† | è•­å®‡è¶…é†«å¸«æ•´ç†è£½ä½œ</p>
            <p class="text-blue-200 text-xs">è³‡æ–™ä¾†æºï¼šå°ç£åœ‹æ°‘å¥åº·ç½²</p>
        </div>

        <!-- è¡¨å–®å€å¡Š -->
        <div class="p-6 space-y-5">
            
            <!-- å¹´é½¡é¸æ“‡ -->
            <div>
                <label for="age" class="block text-sm font-semibold text-slate-700 mb-2">è«‹é¸æ“‡å¹´é½¡ç¯„åœï¼š</label>
                <select id="age" class="w-full bg-slate-50 border border-slate-300 text-slate-900 rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5 outline-none transition-colors">
                    <option value="1-3">1-3 æ­²</option>
                    <option value="4-6">4-6 æ­²</option>
                    <option value="7-8">7-8 æ­²</option>
                    <option value="9-12">9-12 æ­²</option>
                    <option value="13-15">13-15 æ­²</option>
                    <option value="16-18">16-18 æ­²</option>
                </select>
            </div>

            <!-- æ€§åˆ¥é¸æ“‡ -->
            <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2">è«‹é¸æ“‡æ€§åˆ¥ï¼š</label>
                <div class="flex space-x-4">
                    <label class="flex items-center space-x-2 cursor-pointer bg-slate-50 px-4 py-2 border border-slate-300 rounded-lg flex-1 hover:bg-blue-50 transition-colors">
                        <input type="radio" name="gender" value="ç”·" checked class="w-4 h-4 text-blue-600 focus:ring-blue-500 cursor-pointer">
                        <span class="text-slate-700 font-medium">ğŸ‘¦ ç”·ç”Ÿ</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer bg-slate-50 px-4 py-2 border border-slate-300 rounded-lg flex-1 hover:bg-blue-50 transition-colors">
                        <input type="radio" name="gender" value="å¥³" class="w-4 h-4 text-pink-500 focus:ring-pink-500 cursor-pointer">
                        <span class="text-slate-700 font-medium">ğŸ‘§ å¥³ç”Ÿ</span>
                    </label>
                </div>
            </div>

            <!-- æ´»å‹•å¼·åº¦é¸æ“‡ -->
            <div>
                <label for="activity" class="block text-sm font-semibold text-slate-700 mb-2">è«‹é¸æ“‡æ´»å‹•å¼·åº¦ï¼š</label>
                <select id="activity" class="w-full bg-slate-50 border border-slate-300 text-slate-900 rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5 outline-none transition-colors">
                    <option value="ç¨ä½">ç¨ä½ (å¤šç‚ºéœæ…‹æ´»å‹•)</option>
                    <option value="é©åº¦">é©åº¦ (æœ‰è¦å¾‹é‹å‹•ç¿’æ…£)</option>
                </select>
            </div>

            <!-- æŸ¥è©¢æŒ‰éˆ• -->
            <button onclick="queryDiet()" class="w-full mt-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition-all active:scale-95 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                ğŸ” æŸ¥è©¢é£²é£Ÿå»ºè­°
            </button>

        </div>

        <!-- çµæœé¡¯ç¤ºå€å¡Š (é è¨­éš±è—) -->
        <div id="result-container" class="hidden bg-slate-50 border-t border-slate-100 p-6">
            <h2 class="text-lg font-bold text-slate-800 mb-4 border-b pb-2 flex items-center justify-between">
                <span>ğŸ“‹ æ¯æ—¥é£²é£Ÿå»ºè­°é‡</span>
                <span id="result-calories" class="text-orange-500 font-black text-xl"></span>
            </h2>
            
            <div id="error-message" class="hidden text-red-500 font-medium text-center py-4">
                æŸ¥ç„¡å°æ‡‰çš„é£²é£Ÿå»ºè­°ï¼Œè«‹ç¢ºèªè¼¸å…¥æ¢ä»¶æ˜¯å¦æ­£ç¢ºã€‚
            </div>

            <ul id="result-list" class="space-y-3">
                <!-- Javascript å°‡å‹•æ…‹å¡«å…¥çµæœæ¸…å–® -->
            </ul>
        </div>
    </div>


    <!-- ========================================== -->
    <!-- å¡ç‰‡ 2ï¼šå…’ç«¥åŠé’å°‘å¹´æ¯æ—¥ç†±é‡éœ€æ±‚ (EER) è¨ˆç®—æ©Ÿ -->
    <!-- ========================================== -->
    <div class="bg-white rounded-2xl shadow-xl w-full max-w-lg overflow-hidden border border-slate-100">
        
        <!-- é ‚éƒ¨æ¨™é¡Œå€å¡Š -->
        <div class="bg-indigo-600 p-6 text-white text-center">
            <h2 class="text-2xl font-bold mb-2">âš¡ å…’ç«¥/é’å°‘å¹´ç†±é‡éœ€æ±‚ (EER) è¨ˆç®—æ©Ÿ</h2>
            <p class="text-indigo-200 text-xs">ä¾æ“š IOM 2005 è‡¨åºŠæŒ‡å¼• (å«éé‡/è‚¥èƒ–å°ˆç”¨å…¬å¼)</p>
        </div>

        <div class="p-6 space-y-5">
            <form id="eerForm" class="space-y-5" onsubmit="event.preventDefault(); calculateEER();">
                
                <!-- æ€§åˆ¥é¸æ“‡ -->
                <div>
                    <label class="block text-sm font-semibold text-slate-700 mb-2">æ€§åˆ¥</label>
                    <div class="flex gap-4">
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="eer_gender" value="boy" class="peer sr-only" checked>
                            <div class="rounded-lg border border-slate-200 px-4 py-3 text-center hover:bg-slate-50 peer-checked:border-indigo-500 peer-checked:bg-indigo-50 peer-checked:text-indigo-700 transition-all font-medium">
                                ğŸ‘¦ ç”·å­©
                            </div>
                        </label>
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="eer_gender" value="girl" class="peer sr-only">
                            <div class="rounded-lg border border-slate-200 px-4 py-3 text-center hover:bg-slate-50 peer-checked:border-pink-500 peer-checked:bg-pink-50 peer-checked:text-pink-700 transition-all font-medium">
                                ğŸ‘§ å¥³å­©
                            </div>
                        </label>
                    </div>
                </div>

                <!-- æ•¸å€¼è¼¸å…¥å€ (Grid) -->
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="eer_age" class="block text-sm font-semibold text-slate-700 mb-1">å¹´é½¡ (æ­²)</label>
                        <input type="number" id="eer_age" min="3" max="18" step="0.1" placeholder="3 - 18" class="w-full rounded-lg border border-slate-300 px-4 py-2 focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500" required>
                    </div>
                    <div>
                        <label for="eer_weight" class="block text-sm font-semibold text-slate-700 mb-1">é«”é‡ (å…¬æ–¤)</label>
                        <input type="number" id="eer_weight" min="5" max="150" step="0.1" placeholder="kg" class="w-full rounded-lg border border-slate-300 px-4 py-2 focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500" required>
                    </div>
                    <div class="col-span-2">
                        <label for="eer_height" class="block text-sm font-semibold text-slate-700 mb-1">èº«é«˜ (å…¬åˆ†)</label>
                        <input type="number" id="eer_height" min="50" max="220" step="0.1" placeholder="cm" class="w-full rounded-lg border border-slate-300 px-4 py-2 focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500" required>
                    </div>
                </div>

                <!-- æç¤ºèªªæ˜ï¼šç¾åœ¨ç³»çµ±æœƒè‡ªå‹•è¨ˆç®— BMI ä¸¦æ±ºå®šå…¬å¼ -->
                <div class="bg-indigo-50 border border-indigo-100 rounded-lg p-3 text-sm text-indigo-700 flex items-start gap-2">
                    <span class="text-lg">ğŸ’¡</span>
                    <p>ç³»çµ±å°‡ä¾æ“š<span class="font-bold">å°ç£åœ‹æ°‘å¥åº·ç½²</span>æ¨™æº–è‡ªå‹•è¨ˆç®— BMIã€‚è‹¥é”éé‡æˆ–è‚¥èƒ–æ¨™æº–ï¼Œå°‡è‡ªå‹•å¥—ç”¨å°ˆå±¬ç¶­æŒå…¬å¼é¿å…ç†±é‡é«˜ä¼°ã€‚</p>
                </div>

                <!-- æ´»å‹•é‡é¸æ“‡ -->
                <div>
                    <label for="eer_activity" class="block text-sm font-semibold text-slate-700 mb-1">æ—¥å¸¸æ´»å‹•å¼·åº¦</label>
                    <select id="eer_activity" class="w-full rounded-lg border border-slate-300 px-4 py-2 focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500 bg-white" required>
                        <option value="" disabled selected>è«‹é¸æ“‡æ´»å‹•å¼·åº¦...</option>
                        <option value="sedentary">ä¹…åä¸å‹• (åƒ…åŸºæœ¬æ—¥å¸¸æ´»å‹•)</option>
                        <option value="low">ä½åº¦æ´»å‹• (æ—¥å¸¸ + ç›¸ç•¶æ–¼æ­¥è¡Œ 30-60 åˆ†)</option>
                        <option value="active">ä¸­åº¦æ´»å‹• (æ—¥å¸¸ + ç›¸ç•¶æ–¼æ­¥è¡Œ 60 åˆ†ä»¥ä¸Š)</option>
                        <option value="very">é«˜åº¦æ´»å‹• (æ—¥å¸¸ + 60åˆ†ä¸­åº¦ + åŠ‡çƒˆé‹å‹•)</option>
                    </select>
                </div>

                <!-- éŒ¯èª¤è¨Šæ¯æç¤ºå€ -->
                <div id="errorMsg" class="hidden text-red-600 text-sm font-medium bg-red-50 p-3 rounded-lg"></div>

                <!-- è¨ˆç®—æŒ‰éˆ• -->
                <button type="submit" class="w-full bg-slate-800 text-white font-bold rounded-lg px-4 py-3 hover:bg-slate-700 transition-all shadow-md active:transform active:scale-95">
                    ğŸ§® è¨ˆç®—æ¯æ—¥ç¸½ç†±é‡éœ€æ±‚
                </button>
            </form>

            <!-- çµæœé¡¯ç¤ºå€ -->
            <div id="resultCard" class="hidden mt-8 p-6 bg-gradient-to-br from-indigo-50 to-blue-50 rounded-xl border border-indigo-100 shadow-sm transition-all">
                
                <!-- æ–°å¢ï¼šBMI é¡¯ç¤ºå€å¡Š -->
                <div class="mb-5 p-4 bg-white rounded-lg border border-indigo-100 flex justify-between items-center shadow-sm">
                    <div class="text-sm font-semibold text-slate-500">BMI æ•¸å€¼èˆ‡é«”ä½åˆ¤å®š</div>
                    <div class="flex items-center gap-3">
                        <span id="bmiValue" class="text-2xl font-bold text-slate-700"></span>
                        <span id="bmiStatus" class="px-3 py-1 rounded-full text-sm font-bold shadow-sm"></span>
                    </div>
                </div>

                <h3 class="text-sm font-bold text-slate-600 mb-1 text-center">ä¼°è¨ˆèƒ½é‡éœ€æ±‚ (EER)</h3>
                <div class="flex justify-center items-end gap-2 text-indigo-900">
                    <span id="resultValue" class="text-4xl font-extrabold leading-none"></span>
                    <span class="text-lg font-semibold mb-1">kcal / day</span>
                </div>
                
                <!-- è‡¨åºŠæ¸›é‡æé†’ (é‡å°è‚¥èƒ–å…’ç«¥) -->
                <div id="obesityWarning" class="hidden mt-3 text-center bg-red-100 text-red-700 text-xs font-bold p-2 rounded">
                    âš ï¸ æ­¤ç‚ºã€Œç¶­æŒç›®å‰é«”é‡ã€ä¹‹ç†±é‡ã€‚<br>è‹¥éœ€æ¸›é‡ï¼Œæ‡‰ç”±é†«å¸«è©•ä¼°å¾Œè£½é€ é©ç•¶ç†±é‡èµ¤å­—ã€‚
                </div>

                <div class="mt-4 text-xs text-slate-500 border-t border-indigo-200 pt-3">
                    <strong>ç³»çµ±åˆ¤å®šæ‘˜è¦ï¼š</strong><br>
                    <span id="formulaDetail"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript é‚è¼¯ (åŒ…å«å…©å€‹å·¥å…·çš„ç¨‹å¼ç¢¼) -->
    <script>
        /* ========================================================= */
        /* å·¥å…· 1ï¼šé£²é£Ÿå»ºè­°é‡æŸ¥è©¢é‚è¼¯                                */
        /* ========================================================= */
        const rawData = {
            "å¹´é½¡": [
                "1-3", "1-3", "1-3", "1-3", "4-6", "4-6", "4-6", "4-6",
                "7-8", "7-8", "7-8", "7-8", "9-12", "9-12", "9-12", "9-12",
                "13-15", "13-15", "13-15", "13-15", "16-18", "16-18", "16-18", "16-18"
            ],
            "æ€§åˆ¥": ["ç”·", "ç”·", "å¥³", "å¥³", "ç”·", "ç”·", "å¥³", "å¥³", "ç”·", "ç”·", "å¥³", "å¥³", "ç”·", "ç”·", "å¥³", "å¥³", "ç”·", "ç”·", "å¥³", "å¥³", "ç”·", "ç”·", "å¥³", "å¥³"],
            "æ´»å‹•å¼·åº¦": ["ç¨ä½", "é©åº¦", "ç¨ä½", "é©åº¦", "ç¨ä½", "é©åº¦", "ç¨ä½", "é©åº¦", "ç¨ä½", "é©åº¦", "ç¨ä½", "é©åº¦",
                        "ç¨ä½", "é©åº¦", "ç¨ä½", "é©åº¦", "ç¨ä½", "é©åº¦", "ç¨ä½", "é©åº¦", "ç¨ä½", "é©åº¦", "ç¨ä½", "é©åº¦"],
            "ç†±é‡ (å¤§å¡)": [1150, 1350, 1150, 1350, 1550, 1800, 1400, 1650, 1800, 2100, 1650, 1900, 2050,
                          2350, 1950, 2250, 2400, 2800, 2050, 2350, 2500, 2900, 1900, 2250],
            "å…¨æ¦–é›œç³§é¡ (ç¢—)": [1.5, 2, 1.5, 2, 2.5, 3, 2, 3, 3, 3.5, 2.5, 3, 3, 4, 3, 3.5, 4, 4.5, 3, 4, 4, 4.5, 3, 3.5],
            "è±†é­šè›‹è‚‰é¡ (ä»½)": [2, 3, 2, 3, 3, 4, 3, 3, 5, 6, 4, 5.5, 6, 6, 6, 6, 6, 8, 6, 6, 7, 9, 5.5, 6],
            "ä¹³å“é¡ (æ¯)": [2, 2, 2, 2, 2, 2, 2, 2, 1.5, 1.5, 1.5, 1.5, 1.5, 1.5, 1.5, 1.5, 1.5, 2, 1.5, 1.5, 1.5, 2, 1.5, 1.5],
            "è”¬èœé¡ (ä»½)": [2, 2, 2, 2, 3, 3, 3, 3, 3, 4, 3, 3, 4, 4, 3, 4, 5, 5, 4, 4, 5, 5, 3, 4],
            "æ°´æœé¡ (ä»½)": [2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 2, 3, 3, 4, 3, 3.5, 4, 4, 3, 4, 4, 4, 3, 3.5],
            "æ²¹è„‚èˆ‡å …æœç¨®å­é¡ (ä»½)": [4, 4, 4, 4, 4, 5, 4, 4, 5, 6, 5, 5, 6, 6, 5, 6, 7, 8, 6, 6, 7, 8, 5, 6]
        };

        const dietDatabase = [];
        const rowCount = rawData["å¹´é½¡"].length;
        
        for (let i = 0; i < rowCount; i++) {
            let row = {};
            for (const key in rawData) {
                row[key] = rawData[key][i];
            }
            dietDatabase.push(row);
        }

        const icons = {
            "å…¨æ¦–é›œç³§é¡ (ç¢—)": "ğŸš",
            "è±†é­šè›‹è‚‰é¡ (ä»½)": "ğŸ¥š",
            "ä¹³å“é¡ (æ¯)": "ğŸ¥›",
            "è”¬èœé¡ (ä»½)": "ğŸ¥¬",
            "æ°´æœé¡ (ä»½)": "ğŸ",
            "æ²¹è„‚èˆ‡å …æœç¨®å­é¡ (ä»½)": "ğŸ¥œ"
        };

        function queryDiet() {
            const ageGroup = document.getElementById("age").value;
            const gender = document.querySelector('input[name="gender"]:checked').value;
            const activityLevel = document.getElementById("activity").value;

            const result = dietDatabase.find(
                item => item["å¹´é½¡"] === ageGroup && 
                        item["æ€§åˆ¥"] === gender && 
                        item["æ´»å‹•å¼·åº¦"] === activityLevel
            );

            const container = document.getElementById("result-container");
            const errorMessage = document.getElementById("error-message");
            const resultList = document.getElementById("result-list");
            const caloriesDisplay = document.getElementById("result-calories");

            container.classList.remove("hidden"); 
            resultList.innerHTML = ""; 

            if (!result) {
                errorMessage.classList.remove("hidden");
                resultList.classList.add("hidden");
                caloriesDisplay.textContent = "";
            } else {
                errorMessage.classList.add("hidden");
                resultList.classList.remove("hidden");
                
                caloriesDisplay.textContent = `${result["ç†±é‡ (å¤§å¡)"]} å¤§å¡`;

                const skipKeys = ["å¹´é½¡", "æ€§åˆ¥", "æ´»å‹•å¼·åº¦", "ç†±é‡ (å¤§å¡)"];
                
                for (const [key, value] of Object.entries(result)) {
                    if (!skipKeys.includes(key)) {
                        const icon = icons[key] || "âœ¨";
                        const li = document.createElement("li");
                        li.className = "flex justify-between items-center bg-white p-3 rounded border border-slate-100 shadow-sm";
                        li.innerHTML = `
                            <span class="text-slate-600 font-medium flex items-center gap-2">
                                <span class="text-xl">${icon}</span> ${key}
                            </span>
                            <span class="font-bold text-blue-600 text-lg">${value}</span>
                        `;
                        resultList.appendChild(li);
                    }
                }
            }
        }

        /* ========================================================= */
        /* å·¥å…· 2ï¼šEER ç†±é‡è¨ˆç®—æ©Ÿé‚è¼¯ (åŠ å…¥è‚¥èƒ–å…’ç«¥ä¿®æ­£)               */
        /* ========================================================= */
        
        // æ–°å¢ï¼šåœ‹å¥ç½²å…’ç«¥èˆ‡é’å°‘å¹´ BMI æ¨™æº– (ç”·/å¥³ 3-18æ­²)
        const bmiStandards = {
            boy: {
                3: { under: 14.1, over: 17.2, obese: 18.0 },
                4: { under: 13.9, over: 17.1, obese: 18.1 },
                5: { under: 13.8, over: 17.1, obese: 18.3 },
                6: { under: 13.8, over: 17.2, obese: 18.7 },
                7: { under: 13.9, over: 17.5, obese: 19.3 },
                8: { under: 14.0, over: 17.9, obese: 20.0 },
                9: { under: 14.2, over: 18.4, obese: 20.8 },
                10: { under: 14.5, over: 19.0, obese: 21.6 },
                11: { under: 14.8, over: 19.6, obese: 22.5 },
                12: { under: 15.2, over: 20.3, obese: 23.4 },
                13: { under: 15.7, over: 21.0, obese: 24.3 },
                14: { under: 16.3, over: 21.8, obese: 25.1 },
                15: { under: 16.9, over: 22.5, obese: 25.8 },
                16: { under: 17.4, over: 23.1, obese: 26.4 },
                17: { under: 17.9, over: 23.6, obese: 26.9 },
                18: { under: 18.3, over: 24.0, obese: 27.3 }
            },
            girl: {
                3: { under: 13.7, over: 17.1, obese: 18.0 },
                4: { under: 13.6, over: 16.9, obese: 18.0 },
                5: { under: 13.5, over: 16.9, obese: 18.1 },
                6: { under: 13.5, over: 17.1, obese: 18.5 },
                7: { under: 13.6, over: 17.3, obese: 19.0 },
                8: { under: 13.8, over: 17.8, obese: 19.7 },
                9: { under: 14.0, over: 18.4, obese: 20.4 },
                10: { under: 14.3, over: 19.0, obese: 21.1 },
                11: { under: 14.7, over: 19.7, obese: 21.9 },
                12: { under: 15.2, over: 20.4, obese: 22.7 },
                13: { under: 15.8, over: 21.2, obese: 23.5 },
                14: { under: 16.4, over: 22.0, obese: 24.3 },
                15: { under: 17.0, over: 22.7, obese: 25.1 },
                16: { under: 17.5, over: 23.3, obese: 25.8 },
                17: { under: 17.9, over: 23.8, obese: 26.5 },
                18: { under: 18.2, over: 24.0, obese: 27.0 }
            }
        };

        function calculateEER() {
            const genderElement = document.querySelector('input[name="eer_gender"]:checked');
            const ageInput = document.getElementById('eer_age').value;
            const heightCmInput = document.getElementById('eer_height').value;
            const weightInput = document.getElementById('eer_weight').value;
            const activityInput = document.getElementById('eer_activity').value;
            
            const errorDiv = document.getElementById('errorMsg');
            const resultCard = document.getElementById('resultCard');
            const obesityWarning = document.getElementById('obesityWarning');

            errorDiv.classList.add('hidden');
            resultCard.classList.add('hidden');
            obesityWarning.classList.add('hidden');

            if (!genderElement || !ageInput || !heightCmInput || !weightInput || !activityInput) {
                showError("è«‹å®Œæ•´å¡«å¯«æ‰€æœ‰æ¬„ä½èˆ‡æ´»å‹•å¼·åº¦ã€‚");
                return;
            }

            const gender = genderElement.value;
            const age = parseFloat(ageInput);
            const heightCm = parseFloat(heightCmInput);
            const weight = parseFloat(weightInput);
            const activity = activityInput;

            if (age < 3 || age > 18) {
                showError("æ­¤å…¬å¼åƒ…é©ç”¨æ–¼ 3 è‡³ 18 æ­²çš„å…’ç«¥èˆ‡é’å°‘å¹´ï¼Œè«‹é‡æ–°ç¢ºèªå¹´é½¡ã€‚");
                return;
            }

            const heightM = heightCm / 100;
            const bmi = weight / (heightM * heightM);
            const roundedAge = Math.floor(age);
            const safeAge = Math.min(Math.max(roundedAge, 3), 18); // é™åˆ¶æŸ¥æ‰¾ç¯„åœ
            const standard = bmiStandards[gender][safeAge];

            let statusText = "æ­£å¸¸";
            let statusColor = "bg-green-100 text-green-700";
            let isObese = false;

            // é€²è¡Œé«”ä½åˆ¤å®š
            if (bmi < standard.under) {
                statusText = "é«”é‡éè¼•";
                statusColor = "bg-blue-100 text-blue-700";
            } else if (bmi >= standard.obese) {
                statusText = "è‚¥èƒ–";
                statusColor = "bg-red-100 text-red-700";
                isObese = true;
            } else if (bmi >= standard.over) {
                statusText = "éé‡";
                statusColor = "bg-orange-100 text-orange-700";
                isObese = true;
            }

            // æ›´æ–° UI é¡¯ç¤º BMI çµæœ
            document.getElementById('bmiValue').innerText = bmi.toFixed(1);
            const bmiStatusEl = document.getElementById('bmiStatus');
            bmiStatusEl.innerText = statusText;
            bmiStatusEl.className = `px-3 py-1 rounded-full text-sm font-bold shadow-sm ${statusColor}`;

            let pa = 1.0;
            let eer = 0;
            let formulaType = "æ¨™æº–å¥åº·é«”é‡å…¬å¼";
            let growthAddition = 0;

            if (isObese) {
                // ==========================================
                // IOM 2005 éé‡/è‚¥èƒ–å…’ç«¥å°ˆç”¨å…¬å¼ (ç¶­æŒé«”é‡)
                // ==========================================
                formulaType = "éé‡/è‚¥èƒ–å°ˆç”¨ç¶­æŒå…¬å¼";
                obesityWarning.classList.remove('hidden'); // é¡¯ç¤ºæ¸›é‡è‡¨åºŠæé†’

                if (gender === 'boy') {
                    // ç”·å­©éé‡ PA ä¿‚æ•¸
                    if (activity === 'sedentary') pa = 1.00;
                    else if (activity === 'low') pa = 1.12;
                    else if (activity === 'active') pa = 1.24;
                    else if (activity === 'very') pa = 1.45;

                    eer = -114.1 - (50.9 * age) + (pa * ((19.5 * weight) + (1161.4 * heightM)));
                } else {
                    // å¥³å­©éé‡ PA ä¿‚æ•¸
                    if (activity === 'sedentary') pa = 1.00;
                    else if (activity === 'low') pa = 1.18;
                    else if (activity === 'active') pa = 1.35;
                    else if (activity === 'very') pa = 1.60;

                    eer = 389.2 - (41.2 * age) + (pa * ((15.0 * weight) + (701.6 * heightM)));
                }
            } else {
                // ==========================================
                // IOM 2005 æ¨™æº–å¥åº·é«”é‡å…¬å¼ (å«ç”Ÿé•·ç†±é‡)
                // ==========================================
                growthAddition = (age >= 9) ? 25 : 20;

                if (gender === 'boy') {
                    if (activity === 'sedentary') pa = 1.00;
                    else if (activity === 'low') pa = 1.13;
                    else if (activity === 'active') pa = 1.26;
                    else if (activity === 'very') pa = 1.42;

                    const bodyFactor = (26.7 * weight) + (903 * heightM);
                    eer = 88.5 - (61.9 * age) + (pa * bodyFactor) + growthAddition;
                } else {
                    if (activity === 'sedentary') pa = 1.00;
                    else if (activity === 'low') pa = 1.16;
                    else if (activity === 'active') pa = 1.31;
                    else if (activity === 'very') pa = 1.56;

                    const bodyFactor = (10.0 * weight) + (934 * heightM);
                    eer = 135.3 - (30.8 * age) + (pa * bodyFactor) + growthAddition;
                }
            }

            // é¡¯ç¤ºçµæœ
            document.getElementById('resultValue').innerText = Math.round(eer).toLocaleString();
            
            const genderText = gender === 'boy' ? 'ç”·å­©' : 'å¥³å­©';
            let detailHtml = `å°è±¡ï¼š${age} æ­² ${genderText} <br> å¥—ç”¨æ¨¡çµ„ï¼š<span class="text-indigo-600 font-bold">${formulaType}</span> <br> æ¡ç”¨ PA ä¿‚æ•¸ï¼š${pa}`;
            
            if (!isObese) {
                detailHtml += ` <br> ç”Ÿé•·é™„åŠ ç†±é‡ï¼š+${growthAddition} kcal`;
            }

            document.getElementById('formulaDetail').innerHTML = detailHtml;
            resultCard.classList.remove('hidden');
        }

        function showError(msg) {
            const errorDiv = document.getElementById('errorMsg');
            errorDiv.innerText = msg;
            errorDiv.classList.remove('hidden');
        }
    </script>
</body>
</html>
